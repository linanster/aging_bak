{% extends '_mybase.html' %}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static',filename='css/my.css') }}">
{% endblock styles %}

{% block scripts %}
    {{ super() }}
    <script type="text/javascript">
        //弹出隐藏层
        function ShowDiv(show_div,bg_div){
            document.getElementById(show_div).style.display='block';
            document.getElementById(bg_div).style.display='block' ;
            var bgdiv = document.getElementById(bg_div);
            bgdiv.style.width = document.body.scrollWidth;
            bgdiv.style.height = $(document).height();
            //$("#"+bg_div).height($(document).height());
        };
    </script>
    <script type="text/javascript" charset="utf-8">
        var c = 0
        var t
        function timedCount() {
            document.getElementById('timer').innerHTML = c
            c = c + 1
            t = setTimeout("timedCount()", 1000)
        }
        $('#btn_broadcast').click(function(){
            timedCount();
        });
    </script>

{% endblock scripts %}

{% block indent_content %}
    {{ super() }}
    {% include '_configinfo.html' %}

    <div class="btn-group">
        <form style="display: inline" action="{{ url_for('blue_test.cmd_broadcast') }}" method="post">
            <button id="btn_broadcast" type="submit" class="btn btn-success" {% if not devicecode_broadcast_applicable() %}disabled{% endif %} onclick="ShowDiv('MyDiv','fade')">广播</button>
        </form>
        <form style="display: inline" id='start' action="{{ url_for('blue_test.pre_cmd_start') }}" method="post">
            {# <button type="submit" class="btn btn-success" {% if get_count_stage()>10000 %}disabled{% endif %}>开始</button> #}
            <button type="submit" class="btn btn-success" style="display:inline" {% if count_stage_exceed() or count_archive_exceed() %}disabled{% endif %}>开始</button>
            <div class="radio" style="display:inline"><label title="测试数据不会保存,再次点击“开始”按钮时会被自动清除"><input type="radio" name="mode" value="test" /> 测试模式</label></div>
	    <div class="radio" style="display:inline"><label title="支持测试数据本地保存，并同步至云端"><input type="radio" name="mode" value="production" checked="checked"> 生产模式</label></div>
        </form>
    </div>
    <span class="text-warning">
        {% if count_stage_exceed() %}未同步数据( {{ get_count_stage()}} )过多，请先 <a href="{{ url_for('blue_upload.vf_upload') }}">同步</a> 至云端!{% endif %}
        {% if count_archive_exceed() %}历史数据( {{ get_count_archive()}} )过多，请先 <a href="{{ url_for('blue_manage.vf_data') }}">导出(如需)并清除</a> 历史数据!{% endif %}
        {{ msg }}
    </span>
    &nbsp;&nbsp;&nbsp;

    <table class="table table-striped table-hover ">
        {% include '_thead.html' %}
        <tbody>
        </tbody>
    </table>

    <!--弹出层时背景层DIV-->
    <div id="fade" class="black_overlay">
    </div>
    <div id="MyDiv" class="white_content">
        <div style="text-align: right; cursor: default; height: 40px;">
        </div>
        <h3 style="display: inline">请等待后台广播完成...</h3>
        <h3 id="timer" style="display: inline"></h3>
    </div>

{% endblock %}

